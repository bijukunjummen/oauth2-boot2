<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      layout:decorate="~{layout/sitelayout}">
<head>
    <title>Spring Security - OAuth 2.0 User Info</title>
    <meta charset="utf-8"/>
</head>
<body>
<div class="container-fluid" layout:fragment="content">
    <h3>OAuth 2.0 User Info</h3>
    <div class="row justify-content-end">
        <div class="col-sm-4">
            <div sec:authorize="isAuthenticated()">
                <form class="form-inline" action="#" th:action="@{/logout}" method="post">
                    <div class="form-group mb-2">
                        <label class="col-form-label">User:  </label>
                        <span sec:authentication="name"></span>  
                    </div>
                    <button type="submit" class="btn btn-light mb-2">Logout</button>
                </form>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-1">
            &nbsp;
        </div>
        <div class="col-sm-5">
            <h4>Raw Access Token</h4>
            <textarea th:text="${raw_access_token}" rows="10" cols="70"></textarea>
            
            <h4>Beautified Access Token</h4>
            <pre th:text="${formatted_access_token}"></pre>
        </div>
        <div class="col-sm-5">
            <h4>Raw ID Token</h4>
            <textarea th:text="${raw_id_token}" rows="10" cols="70"></textarea>
            
            <h4>Beautified Id Token</h4>
            <pre th:text="${formatted_id_token}"></pre>
        </div>

        <div class="col-sm-1">
            &nbsp;
        </div>
    </div>
    <div class="row">
        <div class="col-sm-1">
            &nbsp;
        </div>
        <div class="col-sm-5">
            <span style="font-weight:bold">User Attributes:</span>
            <ul>
                <li th:each="userAttribute : ${userAttributes}">
                    <span style="font-weight:bold" th:text="${userAttribute.key}"></span>:
                    <span th:text="${userAttribute.value}"></span>
                </li>
            </ul>

        </div>
        <div class="col-sm-5">
            <h4>Upstream flows</h4>
            Call an upstream service requiring a "resource.read" scope: <a role="button" th:href="@{/upstream/read}" class="btn btn-link btn-sm">Go</a>
            <br/>
            Call an upstream service requiring a "resource.write" scope: <a role="button" th:href="@{/upstream/write}" class="btn btn-link btn-sm">Go</a>

        </div>

    </div>
</div>
</body>
</html>
